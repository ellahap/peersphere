<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerSphere</title>
    <style>
        body {
            display: flex;
            margin: 0;
            font-family: Courier, monospace;
            background: #f5f5f5;
            height: 100vh;
        }
        h2 {
            margin-bottom: 10px;
            padding-bottom: 5px;
        }
        .sidebar {
            background: #dbdbdb;
            padding: 20px;
            width: 200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: space-between;
            height: auto; /* Let the height adjust based on content */
            max-height: 100vh; /* Set a maximum height */
            overflow-y: auto; /* Enable scrolling if content overflows */
        }
        .group-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .group-item {
            display: block;
            padding: 10px;
            border-radius: 20px;
            text-decoration: none;
            color: black;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box;
            text-align: left;
            margin-bottom: 5px;
        }
        .group-item.active {
            background: #1f497d;
            color: white;
        }
        .main-content {
            flex-grow: 1;
            padding: 20px;
        }
        .header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .tabs {
            display: flex;
            gap: 50px;
            padding-top: 5px;
            padding-bottom: 20px;
        }
        .tabs a {
            text-decoration: underline;
            color: black;
        }
        .resources {
            display: grid;
            grid-template-columns: repeat(3, 200px);
            gap: 20px;
            margin-top: 20px;
        }
        .resource-item {
            background: #e0e0e0;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            font-weight: bold;
            width: 200px;
            height: 225px;
            justify-content: center;
            position: relative;
        }
        .resource-item > * {
            margin-top: 0;
        }
        .add-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgb(47, 47, 47);
            color: white;
            border-radius: 50%;
            font-size: 40px;
            text-align: center;
            line-height: 60px;
            cursor: pointer;
        }
        .add-group-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .add-group-form input {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .add-group-form button {
            padding: 5px;
            border-radius: 5px;
            border: none;
            background: #1f497d;
            color: white;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .modal input {
            width: 90%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .modal button {
            padding: 10px 20px;
            background: #1f497d;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
            cursor: pointer;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        .empty-state {
            text-align: center;
            color: #888;
            margin-top: 30px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="group-list">
            <h2 style="text-align: center;">Your Groups</h2>
            <div id="groups-container">
                <!-- Groups will be dynamically added here -->
            </div>
        </div>
        <div class="add-group-form">
            <input type="text" id="group-name" placeholder="Enter group name">
            <button onclick="addGroup()">+ Add Group</button>
        </div>
    </div>

    <div class="main-content">
        <div class="header" id="header" style="display: none;">
            <h1 id="course-name">Course Name</h1>
            <div class="tabs">
                <a href="#">Resources</a>
                <a href="#">Discussion</a>
                <a href="#">Study Session</a>
            </div>
        </div>

        <div class="resources" id="resources-container" style="display: none;">
            <!-- Resource items will be dynamically added here -->
        </div>

        <!-- Empty state message -->
        <div class="empty-state" id="empty-state">
            No groups added yet. Start by adding a group!
        </div>

        <div class="add-btn" onclick="openUploadModal()">+</div>
    </div>

    <!-- Modal for adding a resource -->
    <div class="overlay" id="overlay"></div>
    <div class="modal" id="modal">
        <h2>Add Resource</h2>
        <input type="text" id="resource-title" placeholder="Enter resource title">
        <button onclick="addResource()">Add</button>
    </div>

    <script>
        let groups = [];
        let resources = {}; // Object to store resources for each group

        function addGroup() {
            const groupNameInput = document.getElementById("group-name");
            const groupName = groupNameInput.value.trim();

            if (groupName && !groups.includes(groupName)) {
                groups.push(groupName);
                resources[groupName] = []; // Initialize an empty array for resources
                renderGroups();
                groupNameInput.value = "";

                // Show the main content if it's the first group
                if (groups.length === 1) {
                    document.getElementById("header").style.display = "block";
                    document.getElementById("resources-container").style.display = "grid";
                    document.getElementById("empty-state").style.display = "none";
                    setActiveGroup(groupName);
                }
            } else {
                alert("Please enter a valid and unique group name.");
            }
        }

        function renderGroups() {
            const groupsContainer = document.getElementById("groups-container");
            groupsContainer.innerHTML = "";

            groups.forEach((group, index) => {
                const groupItem = document.createElement("a");
                groupItem.href = "#";
                groupItem.className = "group-item" + (index === 0 ? " active" : "");
                groupItem.textContent = group;
                groupItem.onclick = () => setActiveGroup(group);
                groupsContainer.appendChild(groupItem);
            });

            if (groups.length > 0) {
                setActiveGroup(groups[0]); // Set the first group as active by default
            }
        }

        function setActiveGroup(groupName) {
            // Update the active group in the sidebar
            const groupItems = document.querySelectorAll(".group-item");
            groupItems.forEach(item => {
                if (item.textContent === groupName) {
                    item.classList.add("active");
                } else {
                    item.classList.remove("active");
                }
            });

            // Update the course name in the header
            const courseNameElement = document.getElementById("course-name");
            courseNameElement.textContent = groupName;

            // Render the resources for the selected group
            renderResources(groupName);
        }

        function renderResources(groupName) {
            const resourcesContainer = document.getElementById("resources-container");
            resourcesContainer.innerHTML = "";

            if (resources[groupName]) {
                resources[groupName].forEach(resource => {
                    const newResource = document.createElement("div");
                    newResource.className = "resource-item";
                    newResource.innerHTML = <h3>${resource}</h3>;
                    resourcesContainer.appendChild(newResource);
                });
            }
        }

        // Function to open the modal
        function openModal() {
            if (groups.length === 0) {
                alert("Please add a group first.");
                return;
            }
            document.getElementById("modal").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }

        // Function to close the modal
        function closeModal() {
            document.getElementById("modal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }

        // Function to add a resource
        function addResource() {
            const resourceTitleInput = document.getElementById("resource-title");
            const resourceTitle = resourceTitleInput.value.trim();

            if (resourceTitle) {
                const activeGroup = document.querySelector(".group-item.active").textContent;
                resources[activeGroup].push(resourceTitle); // Add resource to the active group
                renderResources(activeGroup); // Refresh the resources list

                // Clear the input and close the modal
                resourceTitleInput.value = "";
                closeModal();
            } else {
                alert("Please enter a valid resource title.");
            }
        }

        // Close modal when clicking outside of it
        document.getElementById("overlay").addEventListener("click", closeModal);

        renderGroups();

    // file upload front end 
    
    async function addResource() {
        const resourceTitle = document.getElementById("resource-title").value.trim();
        const resourceFile = document.getElementById("resource-file").files[0];

    // Check if the title and file are provided
    if (!resourceTitle || !resourceFile) {
        alert("Please enter a valid title and upload a file.");
        return;
    }

    // Get the active group name
    const activeGroup = document.querySelector(".group-item.active").textContent;
    
    // Create FormData to send the file
    const formData = new FormData();
    formData.append("file", resourceFile);

    try {
        // Send file to Flask backend
        const response = await fetch("/upload", {
            method: "POST",
            body: formData
        });

        const result = await response.json();

        if (result.success) {
            // Add the resource to the active group
            resources[activeGroup].push({
                name: resourceTitle,
                fileName: resourceFile.name
            });
            renderResources(activeGroup);
            closeModal(); // Close the modal after adding the resource
        } else {
            alert(result.error || "Error uploading the file.");
        }
    } catch (error) {
        console.error("Error uploading file:", error);
        alert("Error uploading the file.");
    }
}

// Update renderResources to display the file name
function renderResources(groupName) {
    const resourcesContainer = document.getElementById("resources-container");
    resourcesContainer.innerHTML = "";

    if (resources[groupName]) {
        resources[groupName].forEach(resource => {
            const newResource = document.createElement("div");
            newResource.className = "resource-item";
            newResource.innerHTML = newResource.innerHTML = `<h3>${resource.name}</h3><p>${resource.fileName}</p>`;
            resourcesContainer.appendChild(newResource);
        });
    }
}


// users can upload the content 
let uploadedContent = [];
let selectedContentType = "";

function openUploadModal() {
    document.getElementById("uploadModal").style.display = "block";
    document.getElementById("uploadOverlay").style.display = "block";
}

function closeUploadModal() {
    document.getElementById("uploadModal").style.display = "none";
    document.getElementById("uploadOverlay").style.display = "none";
}

document.getElementById("uploadOverlay").addEventListener("click", closeUploadModal);

function setContentType(type) {
    selectedContentType = type;
    alert(`Selected: ${type}`);
}

function uploadContent() {
    const title = document.getElementById("upload-title").value.trim();
    const file = document.getElementById("upload-file").files[0];

    if (!title || !file || !selectedContentType) {
        alert("Please enter a title, choose a file, and select content type.");
        return;
    }

    uploadedContent.push({
        name: title,
        fileName: file.name,
        type: selectedContentType,
        likes: 0,
        hearts: 0
    });

    document.getElementById("upload-title").value = "";
    document.getElementById("upload-file").value = "";
    selectedContentType = "";

    closeUploadModal();
    renderUploadedContent();
}

function renderUploadedContent() {
    let container = document.getElementById("uploaded-content-container");
    if (!container) {
        container = document.createElement("div");
        container.id = "uploaded-content-container";
        container.style.marginTop = "40px";
        document.querySelector(".main-content").appendChild(container);
    }

    container.innerHTML = "<h2>Your Uploaded Content</h2>";

    uploadedContent.forEach((item, index) => {
        const contentDiv = document.createElement("div");
        contentDiv.style.cssText = "background: #fff; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;";

        // users can react to the various content 
        contentDiv.innerHTML = `
            <div>
                <strong>${item.name}</strong><br>
                <em>${item.type}</em><br>
                <a href="/download/${encodeURIComponent(item.fileName)}" download>📥 Download</a>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="reactToContent(${index}, 'likes')">👍 ${item.likes}</button>
                <button onclick="reactToContent(${index}, 'hearts')">❤️ ${item.hearts}</button>
            </div>
        `;

        container.appendChild(contentDiv);
    });
}

function reactToContent(index, type) {
    if (uploadedContent[index]) {
        uploadedContent[index][type]++;
        renderUploadedContent();
    }
}


    </script>

// Button for uploading content 
<div class="overlay" id="uploadOverlay"></div>
<div class="modal" id="uploadModal">
    <h2>Upload Course Content</h2>
    <input type="text" id="upload-title" placeholder="Enter title">
    <input type="file" id="upload-file">
    <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button onclick="setContentType('Notes')">Notes</button>
        <button onclick="setContentType('PDF')">PDF</button>
        <button onclick="setContentType('PPT')">PowerPoint</button>
    </div>
    <button style="margin-top: 20px;" onclick="uploadContent()">Upload</button>
</div>

</body>
</html>