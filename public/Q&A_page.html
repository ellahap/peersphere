<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q&A Forum</title>
    <style>
        body {
            font-family: Courier, monospace;
            margin: 0;
            padding: 0;
            background: #dbe2ef;
        }
        .container {
            width: 85%;
            margin: 30px auto;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 20px;
            border: 1px solid #a3a5a5;
        }
        h1, h2, h3, p, button, textarea {
            font-family: Courier, monospace;
        }
        h1 {
            text-align: center;
            color: #3f72af;
            margin-bottom: 30px;
        }
        .question-form textarea {
            width: 97.5%;
            height: 60px;
            padding: 12px;
            margin-top: 2px;
            border: 1px solid #a3a5a5;
            border-radius: 10px;
            resize: vertical;
        }
        .answer-form textarea {
            width: 97.5%;
            height: 60px;
            padding: 12px;
            margin-top: 15px;
            border: 1px solid #a3a5a5;
            border-radius: 10px;
            resize: vertical;
        }
        .question-form button, .answer-form button {
            padding: 10px 20px;
            background-color: #3f72af;
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: 0.3s;
        }
        .question-form button:hover, .answer-form button:hover {
            background-color: #112d4e;
        }
        .question-list {
            margin-top: 40px;
        }
        .question-item {
            background-color: #f1f5f8;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            border: 1px solid #a3a5a5;
        }
        .question-item h3 {
            margin-top: 0;
            color: #112d4e;
            font-size: 20px;
        }
        .question-item p {
            margin: 0;
            color: #555;
        }
        .divider {
            margin: 15px 0;
            border-top: 1px solid #a3a5a5;
        }
        .answer-item {
            background-color: #fefefe;
            padding: 15px;
            margin-top: 10px;
            border-radius: 12px;
            border: 1px solid #a3a5a5;
        }
        .vote-buttons {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .vote-buttons button {
            padding: 5px 10px;
            margin-right: 8px;
            background-color: #c9d6df;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }
        .vote-buttons button:hover {
            background-color: #b1bace;
        }
        .vote-buttons button.voted {
            background-color: #a7bbc7;
        }
        .vote-count {
            margin-left: 8px;
            font-weight: bold;
            color: #333;
        }
        h2 {
            color: #3f72af;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="container">

    <a id="back-link" style="display: inline-block; margin: 20px; font-weight: bold; text-decoration: none; background-color: #1f497d; color: white; padding: 10px 15px; border-radius: 5px;">← Back to Home</a>

    <h1 id="group-title"></h1>

   
    

    <!-- Question Submission Form -->
    <div class="question-form">
        <h2>Ask a New Question</h2>
        <form id="questionForm">
            <textarea id="questionInput" placeholder="Type your question here..." required></textarea>
            <br>
            <button type="submit">Submit</button>
        </form>
    </div>

    <!-- Question List -->
    <div class="question-list" id="questionList">
        <h2>Latest Questions</h2>
        <!-- Questions will be dynamically added here -->
    </div>
</div>

<script>


    document.getElementById('questionForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const questionInput = document.getElementById('questionInput');
        const questionText = questionInput.value.trim();

        if (questionText) {
            const questionList = document.getElementById('questionList');
            const newQuestion = document.createElement('div');
            newQuestion.classList.add('question-item');
            newQuestion.innerHTML = `
                <h3>${questionText}</h3>
                <div class="divider"></div>
                <div class="answers"></div>
                <div class="answer-form">
                    <textarea placeholder="Type your answer here..."></textarea>
                    <button type="button">Answer</button>
                </div>
            `;
            questionList.appendChild(newQuestion);
            questionInput.value = '';

            const answerButton = newQuestion.querySelector('.answer-form button');
            answerButton.addEventListener('click', function() {
                const answerTextarea = newQuestion.querySelector('.answer-form textarea');
                const answerText = answerTextarea.value.trim();

                if (answerText) {
                    const answersDiv = newQuestion.querySelector('.answers');
                    const newAnswer = document.createElement('div');
                    newAnswer.classList.add('answer-item');
                    newAnswer.innerHTML = `
                        <p>${answerText}</p>
                        <div class="vote-buttons">
                            <button class="upvote">Upvote</button>
                            <button class="downvote">Downvote</button>
                            <span class="vote-count">0</span>
                        </div>
                    `;
                    answersDiv.appendChild(newAnswer);
                    answerTextarea.value = '';

                    let answerVotes = 0;
                    let userVote = null;
                    const answerUpvoteButton = newAnswer.querySelector('.upvote');
                    const answerDownvoteButton = newAnswer.querySelector('.downvote');
                    const answerVoteCount = newAnswer.querySelector('.vote-count');

                    answerUpvoteButton.addEventListener('click', function() {
                        if (userVote === 'up') {
                            answerVotes--;
                            userVote = null;
                            answerUpvoteButton.classList.remove('voted');
                        } else {
                            if (userVote === 'down') {
                                answerVotes += 2;
                                answerDownvoteButton.classList.remove('voted');
                            } else {
                                answerVotes++;
                            }
                            userVote = 'up';
                            answerUpvoteButton.classList.add('voted');
                        }
                        answerVoteCount.textContent = answerVotes;
                    });

                    answerDownvoteButton.addEventListener('click', function() {
                        if (userVote === 'down') {
                            answerVotes++;
                            userVote = null;
                            answerDownvoteButton.classList.remove('voted');
                        } else {
                            if (userVote === 'up') {
                                answerVotes -= 2;
                                answerUpvoteButton.classList.remove('voted');
                            } else {
                                answerVotes--;
                            }
                            userVote = 'down';
                            answerDownvoteButton.classList.add('voted');
                        }
                        answerVoteCount.textContent = answerVotes;
                    });
                }
            });
        }
    });


    const params = new URLSearchParams(window.location.search);
    const groupId = params.get("group");

    if (groupId) {
        document.getElementById("back-link").href = `/main?group=${groupId}`;

        fetch(`/api/group/${groupId}`)
        .then(res => res.json())
        .then(data => {
            if (data.name) {
            document.getElementById("group-title").textContent = `${data.name} Discussion Board`;
            }
        });
    }

    function runTests() {
        console.log("=== Running PeerSphere Tests ===");

        // Test 1: Add Group
        const testGroupName = "Test Group";
        document.getElementById("group-name").value = testGroupName;
        addGroup();
        console.assert(groups.includes(testGroupName), "Test 1 Failed: Group was not added.");
        console.log("Test 1 Passed: Group added");

        // Test 2: Upload Content
        const dummyFile = new File(["dummy data"], "example.pdf", { type: "application/pdf" });
        document.getElementById("upload-title").value = "Test Upload";
        const uploadInput = document.getElementById("upload-file");
        Object.defineProperty(uploadInput, 'files', {
        value: [dummyFile],
        writable: false
        });
        selectedContentType = "PDF";
        uploadContent();
        console.assert(uploadedContent.length > 0, "Test 2 Failed: Content not uploaded.");
        console.log("Test 2 Passed: Content uploaded");

        // Test 3: React to Content
        const previousLikes = uploadedContent[0].likes;
        reactToContent(0, "likes");
        console.assert(uploadedContent[0].likes === previousLikes + 1, "Test 3 Failed: Like not registered.");
        console.log("Test 3 Passed: Like registered");

        // Test 4: Add Comment
        const testComment = "Great upload!";
        uploadedContent[0].comments = []; // reset
        const mockInput = { value: testComment };
        addComment(0, mockInput);
        console.assert(uploadedContent[0].comments.includes(testComment), "Test 4 Failed: Comment not added.");
        console.log("Test 4 Passed: Comment added");

        console.log("✅ All tests completed.");
    }

    window.onload = () => {
        renderGroups();
        runTests(); // Comment this line out if you don’t want tests to run on page load
    };
</script>

</body>
</html>